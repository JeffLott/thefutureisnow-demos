<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->    
        <link rel="stylesheet" href="styles/main.css">
        <script src="scripts/vendor/modernizr.min.js"></script>
        <script src="scripts/vendor/socket.io/socket.io.min.js"></script>
        <script src="scripts/vendor/handlebars.min.js"></script>
        <script src="scripts/vendor/prettify.min.js"></script>
    </head>
    <body>
        <div class="navbar navbar-fixed-top">
          <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="#">TheFutureisNow</a>
                <ul class="nav">
                  <li class="active"><a href="#">Home</a></li>
                  <li><a href="#websockets">Web Sockets</a></li>
                  <li><a href="#desktopnotifications">Desktop Notifications</a></li>
                  <li><a href="#camera">Camera Access</a></li>
                  <li><a href="#mobile">Mobile</a></li>
                </ul>
            </div>
          </div>
        </div>
        <div id="main-content" class="container">
             <!-- Web Sockets -->
            <section id="websockets">
                <div class="row">
                    <div class="span11">
                        <h1>Web Sockets</h1>
                        <ul>
                            <li>Easily build real-time web apps</li>
                        </ul>
                        <h2>Demo - Real-time Twitter Feed</h2>
                        <input type="text" id="fetchTwitterData" placeholder="Enter a keyword" /><span id="twitter-stream-status"></span>
                        <div id="count">0</div>
                        <ul id="twitter-feed" class="unstyled"></ul>
                    </div>
                </div>
            </section>
            <!-- Desktop Notifications -->
            <section id="desktopnotifications">
                <div class="row">
                    <div class="span11">
                        <h1>Desktop Notifications</h1>
                        <h2>Browser Support</h2>
                        <code>
                            window.webkitNotifications
                        </code>
                    </div>
                </div>
            </section>
            <!-- Camera Access -->
            <section id="camera">
                <div class="row">
                    <div class="span11">
                        <h1>Camera Access</h1>
                        <h2>Browser Support</h2>
                        <iframe src="http://caniuse.com/stream/embed/"></iframe>
<pre class="prettyprint linenums pre-scrollable">
navigator.webkitGetUserMedia(
    {video: true, audio: true}, // Options
    function(localMediaStream) { // Success
        stream = localMediaStream;
        video.src = window.webkitURL.createObjectURL(stream);
    },
    function(err) { // Failure
        console.log('getUserMedia Failed!')
    }
);
</pre>
                    <div class="video-container">
                        <video id="video" width="100%" height="480" autoplay></video>
                    </div>
                </div>
             </section>
            <!-- Mobile -->
            <section id="mobile">
                <div class="row">
                    <div class="span11">
                        <h1>Mobile</h1>
                        <ul>
                            <li>Device Orientation</li>
                            <li>Accelerometer</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
        <footer></footer>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
<!-- TEMPLATES -->
<script id="twitter-template" type="text/x-handlebars-template">
    <li>@{{user.screen_name}} - {{text}}</li>
</script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>

<script>
var Renderer = {
    addTweet : function(data){
        var source   = $("#twitter-template").html();
        var template = Handlebars.compile(source);
        var tweets = $('#twitter-feed');
        tweets.prepend(template(data))
    }
};

$(function(){
    // var map = new Map();
    tweetCount = 0
    //websockets
    //http://thefutureisnow.mattnull.com
    var socket = io.connect('http://mattnull.thefutureisnow.jit.su',{
        port: 80
    });
    
    socket.on('tweets', function (data) {
        console.log(data.coordinates)
        // if(data.coordinates)
            // map.addMarker(data.coordinates.coordinates[0], data.coordinates.coordinates[1])
        if (window.webkitNotifications.checkPermission() == 0) {
            var n = window.webkitNotifications.createNotification(
        'images/emblem-medium.png', '@'+ data.user.screen_name, data.text);
            n.show();
            Renderer.addTweet(data);
        }
        tweetCount++
        $('#count').text(tweetCount)
    });
    $('#fetchTwitterData').on('keyup',function(e){
        if(e.keyCode === 13){
            var val = $(this).val()
            $('#twitter-feed').html('')
            $('#twitter-stream-status').text('Streaming Tweets...')
            tweetCount = 0
            count = $('#count')
            count.text(tweetCount)
            count.show()
            socket.emit('fetchTweets', {search : val});
        }
    });

    // document.querySelector("*").addEventListener('click', function() {
        if (window.webkitNotifications.checkPermission() !== 0) {
            window.webkitNotifications.requestPermission();
        }
    // }, false);

    // Put video listeners into place
    var stream;
    var video = document.getElementById('video'); 
    navigator.webkitGetUserMedia(
        {video: true, audio: true}, // Options
        function(localMediaStream) { // Success
            stream = localMediaStream;
            video.src = window.webkitURL.createObjectURL(stream);
        },
        function(err) { // Failure
            alert('getUserMedia failed: Code ' + err.code);
        }
    );
    //syntax highlighting
    prettyPrint() 
});
</script>
</script>
</body>
</html>
